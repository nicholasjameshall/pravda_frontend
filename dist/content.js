(()=>{"use strict";var e={728:function(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceWorkerActionManager=void 0;class i{constructor(e){this.GET_ANNOTATIONS_URL="https://example.com/get_annotations",this.SAVE_ANNOTATIONS_URL="https://example.com/save_annotations",this.VOTE_ANNOTATION_URL="https://example.com/vote_annotation",this.httpService=e}showAnnotations(e){return n(this,void 0,void 0,(function*(){return console.log(e),chrome.tabs.sendMessage(e.tabId,{method:i.SHOW_ANNOTATIONS,data:e}).then((e=>e),(()=>{throw Error()}))}))}getAnnotations(e){return n(this,void 0,void 0,(function*(){const t={requestUrl:this.GET_ANNOTATIONS_URL,request:e};return this.httpService.get(t).then((e=>e.data))}))}saveAnnotations(e){return n(this,void 0,void 0,(function*(){const t={requestUrl:this.SAVE_ANNOTATIONS_URL,request:e};return this.httpService.post(t).then((e=>e.data))}))}voteAnnotation(e){return n(this,void 0,void 0,(function*(){const t={requestUrl:this.VOTE_ANNOTATION_URL,request:e};return this.httpService.post(t).then((e=>e.data))}))}}t.ServiceWorkerActionManager=i,i.SHOW_ANNOTATIONS="showAnnotations"},801:function(e,t){var n,i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ContentActionManager=t.ContentAction=void 0,function(e){e.SAVE_ANNOTATIONS="saveAnnotations",e.VOTE_ANNOTATION="voteAnnotation"}(n=t.ContentAction||(t.ContentAction={})),t.ContentActionManager=class{constructor(){}saveAnnotations(e){return i(this,void 0,void 0,(function*(){return yield(2e3,new Promise((e=>setTimeout(e,2e3)))),this.sendRequestToServiceWorker(e,n.SAVE_ANNOTATIONS).then((e=>e))}))}voteAnnotation(e){return i(this,void 0,void 0,(function*(){return yield(2e3,new Promise((e=>setTimeout(e,2e3)))),this.sendRequestToServiceWorker(e,n.VOTE_ANNOTATION).then((e=>e))}))}sendRequestToServiceWorker(e,t){return i(this,void 0,void 0,(function*(){return chrome.runtime.sendMessage({method:t,data:e}).then((e=>e))}))}}},162:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationRenderer=void 0;const o=n(709),s=n(987);t.AnnotationRenderer=class{constructor(e,t){this.ANNOTATION_BOX_CLASS="annotation-box",this.ANNOTATION_BOX_TITLE_CLASS="annotation-box-title",this.ANNOTATION_BOX_CONTENT_CLASS="annotation-box-content",this.ANNOTATION_BOX_ACTIONS_CLASS="annotation-box-actions",this.ANNOTATION_BOX_BUTTON_CLASS="annotation-box-button",this.ANNOTATION_BOX_LOADING_GIF_CLASS="annotation-box-loading-gif",this.ANNOTATION_BOX_ROW_CLASS="annotation-box-row",this.ANNOTATION_BOX_COL_SMALL_CLASS="annotation-box-col-small",this.ANNOTATION_BOX_COL_LARGE_CLASS="annotation-box-col-large",this.ANNOTATION_BOX_VOTE_CLASS="annotation-box-vote",this.ANNOTATION_BOX_SELECTED_CLASS="selected",this.ANNOTATION_BOX_ACTION_SUCCESS_CLASS="success-icon-container",this.ANNOTATION_BOX_ACTION_FAILURE_CLASS="failure-icon-container",this.BUTTON_CLOSE_TEXT="CLOSE",this.ELEMENT_TYPE_PARAGRAPH="P",this.elementBuilder=e,this.actionsManager=t,this.element=this.createAnnotationBoxElement()}getElement(){return this.element}showAnnotations(e){const t=Array.from(e.keys()),n=document.body,i=new Map(this.getElementsWithText(n,t).filter((e=>e.location.el.tagName==this.ELEMENT_TYPE_PARAGRAPH)).map((e=>[e.text,e.location])));for(let[t,n]of e.entries())if(i.has(t)){const e=i.get(t);this.highlightText(t,e,n)}}voteAnnotation(e,t,n){this.showLoader();const i={text:e,annotation:t,type:n};this.actionsManager.voteAnnotation(i).then((e=>{this.hideLoader(),this.showSuccess(),console.log(e)}))}createAnnotationBoxElement(){const e=this.elementBuilder.createElement([this.ANNOTATION_BOX_CLASS]),t=this.elementBuilder.createElement([this.ANNOTATION_BOX_TITLE_CLASS]),n=this.elementBuilder.createElement([this.ANNOTATION_BOX_CONTENT_CLASS]),i=this.elementBuilder.createElement([this.ANNOTATION_BOX_ACTIONS_CLASS]),o=this.elementBuilder.createButton(this.BUTTON_CLOSE_TEXT,[this.ANNOTATION_BOX_BUTTON_CLASS,"secondary"]);o.addEventListener("click",(()=>{this.hide()}));const s=this.elementBuilder.createLoadingGif([this.ANNOTATION_BOX_LOADING_GIF_CLASS]),a=this.elementBuilder.createElement([this.ANNOTATION_BOX_ACTION_SUCCESS_CLASS],"âœ“");return i.appendChild(s),i.appendChild(a),i.appendChild(o),e.appendChild(t),e.appendChild(n),e.appendChild(i),e}highlightText(e,t,n){const i=t.el.innerHTML.substring(0,t.startPos),o=t.el.innerHTML.substring(t.startPos,t.endPos),s=t.el.innerHTML.substring(t.endPos);t.el.innerHTML=i+"<span style='color:red; cursor:pointer'>"+o+"</span>"+s,t.el.addEventListener("click",(()=>{this.showAnnotationsBox(e,n)}))}showAnnotationsBox(e,t){const n=this.element.getElementsByClassName(this.ANNOTATION_BOX_TITLE_CLASS)[0],i=this.element.getElementsByClassName(this.ANNOTATION_BOX_CONTENT_CLASS)[0];n.innerHTML=e,i.innerHTML="";const a=t.map((e=>{const t=this.elementBuilder.createElement([this.ANNOTATION_BOX_ROW_CLASS]),n=this.elementBuilder.createElement([this.ANNOTATION_BOX_COL_SMALL_CLASS],e.votes.toString()),i=this.elementBuilder.createElement([this.ANNOTATION_BOX_COL_LARGE_CLASS],(0,o.toHumanFriendlyText)(e.annotation)),a=this.elementBuilder.createElement([this.ANNOTATION_BOX_COL_SMALL_CLASS]),r=this.elementBuilder.createElement([this.ANNOTATION_BOX_VOTE_CLASS,e.userSelection==s.VoteType.UPVOTE?this.ANNOTATION_BOX_SELECTED_CLASS:""],"&#128077;");r.addEventListener("click",(()=>{this.voteAnnotation("Hello",e.annotation,s.VoteType.UPVOTE)}));const l=this.elementBuilder.createElement([this.ANNOTATION_BOX_COL_SMALL_CLASS]),h=this.elementBuilder.createElement([this.ANNOTATION_BOX_VOTE_CLASS,e.userSelection==s.VoteType.DOWNVOTE?this.ANNOTATION_BOX_SELECTED_CLASS:""],"&#128078;");return h.addEventListener("click",(()=>{this.voteAnnotation("Hello",e.annotation,s.VoteType.DOWNVOTE)})),a.appendChild(r),l.appendChild(h),t.appendChild(i),t.appendChild(a),t.appendChild(l),t.appendChild(n),t}));for(let e of a)i.appendChild(e);this.display()}hide(){this.element.style.display="none"}display(){this.element.style.display="inline"}showLoader(){this.element.getElementsByClassName(this.ANNOTATION_BOX_LOADING_GIF_CLASS)[0].style.display="block",console.log("Loading...")}hideLoader(){this.element.getElementsByClassName(this.ANNOTATION_BOX_LOADING_GIF_CLASS)[0].style.display="none",console.log("Waiting over!")}showSuccess(){return i(this,void 0,void 0,(function*(){const e=this.element.getElementsByClassName(this.ANNOTATION_BOX_ACTION_SUCCESS_CLASS)[0];e.style.display="block",yield(4e3,new Promise((e=>setTimeout(e,4e3)))),e.style.display="none",console.log("Success!")}))}showFailure(){return i(this,void 0,void 0,(function*(){const e=this.element.getElementsByClassName(this.ANNOTATION_BOX_ACTION_FAILURE_CLASS)[0];e.style.display="block",yield(2e3,new Promise((e=>setTimeout(e,2e3)))),e.style.display="none",console.log("Failure!")}))}elementContainsText(e,t){return null!=e.textContent&&e.textContent.indexOf(t)>=0}toTextWithTextLocation(e,t){const n=e.textContent.indexOf(t);return{text:t,location:{el:e,startPos:n,endPos:n+t.length}}}getTextsInElement(e,t){return t.filter((t=>this.elementContainsText(e,t))).map((t=>this.toTextWithTextLocation(e,t)))}getElementsWithText(e,t){if(null==e.firstElementChild)return this.getTextsInElement(e,t);let n=[];for(e=e.firstElementChild;e;)n=n.concat(this.getElementsWithText(e,t)),e=e.nextElementSibling;return n}}},672:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationSelectionBox=void 0;const i=n(709);t.AnnotationSelectionBox=class{get isHidden(){return"none"==this.element.style.display}constructor(e,t){this.SELECTION_BOX_CLASS="selection-box",this.SELECTION_BOX_TITLE_CLASS="selection-box-title",this.SELECTION_BOX_CONTENT_CLASS="selection-box-content",this.SELECTION_BOX_ACTION_CLASS="selection-box-action",this.SELECTION_BOX_BUTTON_CLASS="selection-box-button",this.SELECTION_BOX_CHECKBOX_CLASS="selection-box-checkbox",this.SELECTION_BOX_LOADING_GIF_CLASS="selection-box-loading-gif",this.BUTTON_SUBMIT_TEXT="SUBMIT",this.BUTTON_CLOSE_TEXT="CLOSE",this.elementBuilder=e,this.actionManager=t,this.selection=null,this.checkboxes=[],this.element=this.createAnnotationSelectionBoxElement()}getElement(){return this.element}display(e){if(!this.element)throw Error("Element not found");this.resetCheckboxes(),this.selection=e,this.element.getElementsByClassName(this.SELECTION_BOX_TITLE_CLASS)[0].innerHTML=e.toString(),this.element.style.display="inline"}hide(){this.element&&(this.element.style.display="none")}submitInput(){const e=this.checkboxes.filter((e=>e.checked)).map((e=>{if(Object.values(i.TextAnnotation).includes(e.name))return e.name;throw Error("Unrecognised text annotation")}));if(null==this.selection||0==this.selection.toString().length)return void this.showError("Invalid selection");if(0==e.length)return void this.showError("No annotations selected");this.disableButtons(),this.showLoader();const t={text:this.selection.toString(),annotations:e};this.actionManager.saveAnnotations(t).then((()=>{this.showSuccess(),this.enableButtons(),this.hideLoader()}),(()=>{this.showError("Could not save annotation"),this.enableButtons(),this.hideLoader()}))}showSuccess(){console.log("Success!")}showError(e){console.log(e)}disableButtons(){const e=this.element.getElementsByClassName(this.SELECTION_BOX_BUTTON_CLASS);for(let t of e)t.disabled=!0}enableButtons(){const e=this.element.getElementsByClassName(this.SELECTION_BOX_BUTTON_CLASS);for(let t of e)t.disabled=!1}showLoader(){this.element.getElementsByClassName(this.SELECTION_BOX_LOADING_GIF_CLASS)[0].style.display="block",console.log("Loading...")}hideLoader(){this.element.getElementsByClassName(this.SELECTION_BOX_LOADING_GIF_CLASS)[0].style.display="none",console.log("Success!")}resetCheckboxes(){for(let e of this.checkboxes)e.checked=!1}createAnnotationSelectionBoxElement(){const e=[{id:i.TextAnnotation.INACCURATE,title:"Inaccurate",label:"This statement is inaccurate"},{id:i.TextAnnotation.CONTAINS_BIAS,title:"Bias",label:"This statement contains bias"},{id:i.TextAnnotation.NO_SUPPORTING_EVIDENCE,title:"Unsupported",label:"This statement is unsupported by evidence"}],t=this.elementBuilder.createElement([this.SELECTION_BOX_CLASS]),n=this.elementBuilder.createElement([this.SELECTION_BOX_TITLE_CLASS]),o=this.elementBuilder.createElement([this.SELECTION_BOX_CONTENT_CLASS]),s=this.elementBuilder.createElement([this.SELECTION_BOX_ACTION_CLASS]),a=this.elementBuilder.createButton(this.BUTTON_SUBMIT_TEXT,[this.SELECTION_BOX_BUTTON_CLASS,"primary"]);a.addEventListener("click",(()=>{this.submitInput()}));const r=this.elementBuilder.createButton(this.BUTTON_CLOSE_TEXT,[this.SELECTION_BOX_BUTTON_CLASS,"secondary"]);r.addEventListener("click",(()=>{this.hide()}));const l=this.elementBuilder.createLoadingGif([this.SELECTION_BOX_LOADING_GIF_CLASS]);t.appendChild(n),t.appendChild(o),t.appendChild(s);for(let t of e){const e=this.elementBuilder.createElement([]),n=this.elementBuilder.createCheckbox(t.id,t.title,[this.SELECTION_BOX_CHECKBOX_CLASS]),i=this.elementBuilder.createCheckboxLabel(n,t.label);this.checkboxes.push(n),e.appendChild(n),e.appendChild(i),o.appendChild(e)}return s.appendChild(l),s.appendChild(a),s.appendChild(r),t}}},506:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ElementBuilder=void 0,function(e){e.DIV="div",e.INPUT="input",e.LABEL="label",e.IMG="img"}(n||(n={})),t.ElementBuilder=class{constructor(){this.ATTRIBUTE_ID="id",this.ATTRIBUTE_TYPE="type",this.ATTRIBUTE_NAME="name",this.ATTRIBUTE_FOR="for",this.LOADING_GIF_SRC="/rsc/loading.gif",this.LOADING_GIF_CLASS="loader"}createElement(e,t){const i=document.createElement(n.DIV);return this.addClasses(i,e),i.innerHTML=null!=t?t:"",i}createLoadingGif(e){const t=this.createElement(e),n=this.createElement([this.LOADING_GIF_CLASS]);return t.appendChild(n),t}createButton(e,t){const i=document.createElement(n.INPUT);return i.setAttribute(this.ATTRIBUTE_TYPE,"button"),this.addClasses(i,t),i.value=e,i}createCheckbox(e,t,i){const o=document.createElement(n.INPUT);return this.addClasses(o,i),o.setAttribute(this.ATTRIBUTE_TYPE,"checkbox"),o.setAttribute(this.ATTRIBUTE_ID,e),o.setAttribute(this.ATTRIBUTE_NAME,e),o.value=t,o}createCheckboxLabel(e,t){const i=document.createElement(n.LABEL),o=e.getAttribute(this.ATTRIBUTE_ID);if(null==o)throw Error("Invalid checkbox");return i.setAttribute(this.ATTRIBUTE_FOR,o),i.textContent=t,i}addClasses(e,t){for(let n of t)""!=n&&e.classList.add(n)}}},709:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.toHumanFriendlyText=t.TextAnnotation=void 0,function(e){e.CONTAINS_BIAS="containsBias",e.INACCURATE="inaccurate",e.NO_SUPPORTING_EVIDENCE="noSupportingEvidence"}(n=t.TextAnnotation||(t.TextAnnotation={})),t.toHumanFriendlyText=function(e){switch(e){case n.CONTAINS_BIAS:return"Contains bias";case n.INACCURATE:return"Inaccurate";case n.NO_SUPPORTING_EVIDENCE:return"No supporting evidence";default:throw Error("Text annotation not found")}}},987:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.VoteType=void 0,(n=t.VoteType||(t.VoteType={}))[n.UPVOTE=0]="UPVOTE",n[n.DOWNVOTE=1]="DOWNVOTE",n[n.NO_VOTE=2]="NO_VOTE"}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}(()=>{const e=n(672),t=n(162),i=n(728),o=n(506),s=n(801),a=new o.ElementBuilder,r=new s.ContentActionManager,l=new e.AnnotationSelectionBox(a,r),h=l.getElement();document.body.appendChild(h);const c=new t.AnnotationRenderer(a,r),T=c.getElement();document.body.appendChild(T),chrome.runtime.onMessage.addListener(((e,t,n)=>{if(e.method!=i.ServiceWorkerActionManager.SHOW_ANNOTATIONS)throw new Error("Content script endpoint not found");{const t=e.data;c.showAnnotations(new Map(t.textsToAnnotations)),n({status:"Success"})}})),document.addEventListener("mouseup",(e=>{const t=window.getSelection(),n=e.composedPath().includes(h);l.isHidden||n?l.isHidden&&t&&function(e){return!(!e||!e.toString()||e.toString.length>200)}(t)&&l.display(t):l.hide()}))})()})();